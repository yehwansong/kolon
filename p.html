<!DOCTYPE html>

<head>
  <link rel="stylesheet" href="common.css">
  <meta charset="utf-8">
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' />
  <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
  <script type="text/javascript" src="firebase-load.js"></script>
  <script type="text/javascript">
  // sun
  // output : none
  // input : e, a

  var firebaseValues = {}
  var valuecounter = 0;
  var run_aniing = false;
var timeout;

  function onFirebaseReady() {
    console.log('onFirebaseReady handler');

    var counter = 0
    setInterval(function() {
      if (firebaseValues.e) {
        counter++
        console.log(counter)
        $('.video').hide()
        $('.video_' + counter % 5).show()
      }
    }, 500);
  }
  var changed = false
  var vid_counter = 0
  var timeout
  function change_ch(){
    if(!changed){
      vid_counter++
      $('video').css({'opacity':'0'})
      $('video').eq((vid_counter%$('video').length)).css({'opacity':'1'})
      console.log($('video').eq((vid_counter%$('video').length)))
      console.log((vid_counter%$('video').length))
    }
    changed = true
    timeout = setTimeout(function(){
      changed = false
      change_ch()
    },1000)
  }

  function firebaseValueChangeHandler(values) {
    console.log('firebaseValueChangeHandler')

    // input
    if (values.a) {
      change_ch()
    } else {
      clearTimeout(timeout)
      changed = false
    }
    if (values.d) {
      change_ch()
    } else {
      clearTimeout(timeout)
      changed = false
    }

    firebaseValues.e = values.e
  }
  function run_ani(){
      valuecounter++
      $('.video').css({ 'transform': 'translateX('+ -1*valuecounter%(window.innerHeight/2*5) + 'px)' })
    if(run_aniing){
      setTimeout(function(){
        run_ani()
      },3)
    }
  }
  </script>
  <style>
    body{
    background: black;}
  .sun {
    position: absolute;
    width: 100vw;
    height: 100vw;
    background: red;
    border-radius: 50%;
  }
  video{
    /*transition: opacity 0.5s;*/
    position: absolute;
    left: 0;
    top: 0;
    height: 100vh;
    float: left;
    display: inline-block;
  }
  .video_wrapper{
    width: 50vh;
    height: 100vh;
    left: calc(50vw - 25vh);
    overflow:hidden;
    position: absolute;
  }
  </style>
</head>

<body>
<div class="video_wrapper">
  <!-- FIXME set video src -->
  <video autoplay loop muted  class="video video_0">
    <source src="vid/vid5.mp4" type="video/mp4" />
  </video>
  <video autoplay loop muted  class="video video_1">
    <source src="vid/vid2.mp4" type="video/mp4" />
  </video>
  <video autoplay loop muted  class="video video_2">
    <source src="vid/vid3.mp4" type="video/mp4" />
  </video>
  <video autoplay loop muted  class="video video_3">
    <source src="vid/vid4.mp4" type="video/mp4" />
  </video>
  <video autoplay loop muted  class="video video_4">
    <source src="vid/vid1.mp4" type="video/mp4" />
  </video>
</div>
</body>